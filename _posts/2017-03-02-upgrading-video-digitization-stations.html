---
layout: post
title: Upgrading Video Digitization Stations
date: 2017-03-02 12:10:40.000000000 -05:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Digital Preservation
- Repair and Maintenance
- Software
- Video Preservation
tags: []
meta:
  _oembed_c5e388fa6066de91571997009965baa8: "{{unknown}}"
  _thumbnail_id: '2460'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '2429922314'
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:5947049;s:55:"https://twitter.com/The_BFOOL/status/837349485789474816";}}
  _publicize_done_14287373: '1'
  _wpas_done_5947049: '1'
  publicize_twitter_user: The_BFOOL
author:
  login: bestfilmsofourlives
  email: e.gates42@gmail.com
  display_name: Ethan
  first_name: ''
  last_name: ''
---
<p>In the primary MIAP lab we have four Mac Pro stations set up mainly for video digitization and capture. They get most heavily used during our two Video Preservation courses: Video Preservation I, which focuses on technical principles and practice of digitization from analog video sources, and Video Preservation II, which focuses more on vendor relations and guiding outsourced mass digitization projects, but by necessity involves a fair amount of digital video quality control/quality assurance as well. They get used for assorted projects in Collections Management, the "Talking Tech" workshops I've started leading myself, and the Cinema Studies department's archive as well.</p>
<p>Over the course of 2016, the hardware on these four stations was really starting to show its age. These machines were originally bought and set up in 2012 - putting them in the last generation of the older "tower"-style silver Mac Pro desktops, before Apple radically shifted its hardware design to the "trash bin" style Mac Pros that you can buy today. The operating system hadn't been updated in a while either, they were still running Mac OSX 10.10 (Yosemite), whose last full update came in August 2015 (with a few security updates still following, at least).</p>
<p>[caption id="attachment_2417" align="aligncenter" width="538"]<img class="  wp-image-2417 aligncenter" src="{{ site.baseurl }}/images/maxresdefault.jpg?w=680" alt="maxresdefault" width="538" height="303" /> This guy isn't allowed in anymore, for instance.[/caption]</p>
<p>These stations were stable - at least, in the sense that all the software we needed definitely worked, and they would get the job done of digitizing/capturing analog video. But the limitations of how quickly and efficiently they could do this work was more and more apparent. The amount of time it took, to, say, create a <a href="https://patchbaytech.wordpress.com/2016/09/20/using-bagit/">bag</a> out of 200 GB of uncompressed video, transcode derivative copies, run an rsync script to back video packages up to a local NAS unit, or move the files to/from external  drives (a frequent case, as both Video Preservation classes usually partner with other cultural organizations in New York City who come to pick up their newly-digitized material via hard drive) was getting excruciating relative to newer systems, wasting class time and requiring a lot of coordination/planning of resources as ffmpeg or rsync chugged along for hours, or even overnight.</p>
<p>So, I knew it was time to upgrade our stations. But how to go about it? There were two basic options:</p>
<p><strong>1. Purchase brand-new "trash bin" Mac Pros to replace the older stations</strong></p>
<p>[caption id="attachment_2412" align="aligncenter" width="466"]<img class="  wp-image-2412 aligncenter" src="{{ site.baseurl }}/images/pratttrashcan_macpro.jpg?w=680" alt="pratttrashcan_macpro" width="466" height="282" /> <a href="http://rudypospisil.com/wordpress/wp-content/uploads/2013/10/prattTrashCan_macPro.jpg">http://rudypospisil.com/wordpress/wp-content/uploads/2013/10/prattTrashCan_macPro.jpg</a>[/caption]</p>
<p><strong>2. Open up the innards of the old Mac Pros and swap in updated, more powerful components</strong></p>
<p>Buying brand-new Windows stations was basically out, just given the way our classes have been taught, the software we work with, and my own personal knowledge/preference/ability to maintain hardware. And I was lucky that #1 was even an option at all - the considerable resources available at NYU allow for choices that I would not have many other places. But, MIAP also has <span style="text-decoration:underline;">a lot</span> of equipment needs, and I'd generally rather stash larger portions of our budget towards harder-to-get analog video equipment and refurbishment, than jump for splashy new hardware that we don't actually need. So I drew up some thoughts on what I actually wanted to accomplish:</p>
<ul>
<li>improved data transfer rate between desktops and external drives (the fastest connection available, at best, was the mid-2012 Mac Pro's native <a href="https://amiaopensource.github.io/cable-bible/#firewire_data" target="_blank">FireWire 800</a> ports; and many times we were limited to USB 2.0)</li>
<li>improved application multi-tasking (allow for, say, a Blackmagic Media Express capture to run at the same time as the ffmpeg transcode of a previous capture)</li>
<li>improved single-application processing power (speed up transcoding, bag creation and validation, rsync transfer if possible)</li>
<li>update operating system to OSX 10.11 (El Capitan, a more secure and up-to-date release than Yosemite and MUCH more stable than the new 10.12 Sierra)</li>
<li>maintain software functionality with a few older programs, especially Final Cut 7 or equivalent native-DV capture software</li>
</ul>
<p>Consulting with adjunct faculty, a few friends, and the good old internet, it became clear that a quick upgrade by way of just purchasing new Mac Pros would pose several issues: first, that the Blackmagic Decklink Studio 2 capture cards we used for analog video digitization would not be compatible, requiring additional purchases of stand-alone Blackmagic analog-to-digital converter boxes on top of the new desktops to maintain current workflows. It is also more difficult to cheaply upgrade or replace the storage inside the newer Mac Pros, again likely requiring the eventual purchase of stand-alone RAID storage units to keep up with the amount of uncompressed video being pumped out; whereas the old Mac Pro towers have four internal drive slots that can be swapped in and out within minutes, with minimal expertise, and be easily arranged into various internal RAID configurations.</p>
<p>In other words, I decided it was much cheaper and more efficient to keep the existing Mac Pro stations, which are extremely flexible and easy to upgrade, and via new components bring them more or less up to speed with what completely new Mac Pros could offer anyway. In addition to the four swappable storage slots, the old Mac Pro towers feature easy-to-replace RAM modules, and PCI expansion slots on the back that offer the option to add extra data buses (i.e. more USB, eSATA, or Thunderbolt ports). You <em>can</em> also update the CPU itself - but while adding a processor with more cores would in theory (if I understand the theory, which is also far from a 100% proposition) be the single biggest boost to improving/speeding up processing, the Intel Quad-Core processors already in the old towers are no slouch (the default new models of the Mac Pro still have Quad-Cores), and would be more expensive and difficult to replace than those other pieces. Again, it seemed more efficient, and safer given my limited history with building computer hardware, to incrementally upgrade all the other parts, see what we're working with, and someday in the future step up the CPU if we really, desperately need to breathe more life into these machines.</p>
<p>So, for each of the four stations, here were the upgrades made (separation made between the upgrade and specific model/pricing found; for any of these you could pursue other brands/models/sellers as well):</p>
<ul>
<li>(1) 120 GB solid-state drive (for operating system and applications)</li>
</ul>
<p>OWC Mercury Extreme Pro 6G SSD: <a href="https://www.bhphotovideo.com/c/product/1044906-REG/owc_other_world_computing_owcssd7p6g120_120gb_mercury_extreme_pro.html" target="_blank">$77/unit</a><br />
OWC Mount Pro Drive Sled (necessary to mount SSDs in old Mac Pros): <a href="https://www.bhphotovideo.com/c/product/757269-REG/OWC_Other_World_Computing_OWCMMP35T25_Mount_Pro_2_5_Drive.html" target="_blank">$17/unit</a></p>
<ul>
<li>(1) 1 TB hard drive (for general data storage - more on this later)</li>
</ul>
<p>Western Digital Caviar Blue 1 TB Internal HDD: <a href="https://www.bhphotovideo.com/c/product/903174-REG/western_digital_wd10ezex_1tb_wd_caviar_blue.html" target="_blank">$50/unit</a></p>
<ul>
<li>(1) PCI Express Expansion Card, w/ eSATA, USB 3.0 and USB 3.1 capability</li>
</ul>
<p>CalDigit FASTA-6GU3 Plus: <a href="https://www.bhphotovideo.com/c/product/1239743-REG/caldigit_500022_fasta_6gu3_plus_pcie_card.html" target="_blank">$161/unit</a></p>
<ul>
<li>(4) 8 GB RAM modules, for a total of 32 GB</li>
</ul>
<p>OWC 32.0 GB Upgrade Kit: <a href="https://www.bhphotovideo.com/c/product/1212921-REG/owc_other_world_computing_owc85mp3w8m32k_32gb_4_x_8gb.html" target="_blank">$139/unit</a></p>
<p>[caption id="attachment_2451" align="aligncenter" width="583"]<img class="  wp-image-2451 aligncenter" src="{{ site.baseurl }}/images/img_2839.jpg" alt="IMG_2839.JPG" width="583" height="437" /> Swaaaaaaaaaaag[/caption]</p>
<p>Summed up, that's less than $500 per computer and less than $2000 for the whole lab, which is a pretty good price for (hopefully) speeding up our digitization workflow and keeping our Video Preservation courses functional for at least a couple more years.</p>
<p>The thinking: with all that RAM, multi-tasking applications shouldn't be an issue, even with higher-resource applications like Final Cut 7, Blackmagic Media Express, ffmpeg, etc. With the OSX El Capitan operating system and all applications hosted on solid-state memory (the 120 GB SSD) rather than hard drive, single applications should run much faster (as the drives don't need to literally spin around to find application or system data). By buying a new 1 TB hard drive for each computer, the three non-OS drive slots on each computer are now <em>all</em> filled with 1 TB hard drives. I could have two of those configured in a RAID 0 stripe arrangement, to increase the read and write speed of user data (i.e. video captures) - the third drive can serve as general backup or as storage for non-video digitization projects, as needed.</p>
<p>[caption id="attachment_2467" align="aligncenter" width="575"]<img class="  wp-image-2467 aligncenter" src="{{ site.baseurl }}/images/img_2843.jpg" alt="IMG_2843.JPG" width="575" height="431" /> RAM for days[/caption]</p>
<p>[caption id="attachment_2476" align="aligncenter" width="582"]<img class="  wp-image-2476 aligncenter" src="{{ site.baseurl }}/images/img_2854.jpg" alt="IMG_2854.JPG" width="582" height="436" /> *Oh what fun it is to ride in a one-120-GB-solid-state-drive open sled*[/caption]</p>
<p><img class="  wp-image-2480 aligncenter" src="{{ site.baseurl }}/images/img_2855.jpg" alt="IMG_2855.JPG" width="580" height="435" /></p>
<p><img class="  wp-image-2482 aligncenter" src="{{ site.baseurl }}/images/img_2856.jpg" alt="IMG_2856.JPG" width="584" height="438" /></p>
<p>The expansion cards will now allow eSATA or USB 3.0-speed transfers to compatible external drives. The USB 3.1 function on the specific CalDigit cards I got won't work unless I upgrade the operating system to 10.12 Sierra, which I don't want to do just yet. That's basically the one downside compared to the all-new Mac Pros, which would've offered the Thunderbolt transfer speeds better than USB 3.0 - but for now, USB 3.0 is A) still a drastic improvement over what we had before, B) probably the most common connection on the consumer external drives we see anyway, and C) with an inevitable operating system upgrade we'll "unlock" the USB 3.1 capability to keep up as USB 3.1 connections become more common on external drives.</p>
<p>[caption id="attachment_2488" align="aligncenter" width="619"]<img class="aligncenter  wp-image-2488" src="{{ site.baseurl }}/images/img_28495.jpg" alt="IMG_2849.JPG" width="619" height="464" /> Uninstalled...[/caption]</p>
<p>[caption id="attachment_2455" align="aligncenter" width="514"]<img class="  wp-image-2455 aligncenter" src="{{ site.baseurl }}/images/img_2852.jpg?w=3264" alt="IMG_2852.JPG" width="514" height="686" /> ...installed! Top row - followed by two slots for the Blackmagic Decklink Studio 2 input/output and the AMD Radeon graphics card input/output at the bottom.[/caption]</p>
<p>Installing all these components was a breeze. Seriously! Even if you don't know your way around the inside of a computer at all, the old Mac Pro towers were basically designed to be super customizable and easy to swap out parts, and there's tons of clear, <a href="https://eshop.macsales.com/installvideos/macpro_2010/" target="_blank">well-illustrated instructional videos</a> available to follow.</p>
<p>[vimeo 139648427 w=640 h=360]</p>
<p>As I mentioned in a <a href="https://patchbaytech.wordpress.com/2016/11/22/changing-a-cmos-battery/">previous post about opening up computers</a>, the main issue was grounding. Static discharge damaging the internal parts of your computer is always a risk when you go rooting around and touching components, and especially since the MIAP lab is carpeted I was a bit worried about accidentally frying a CPU with my shaky, novice hands. So I also picked up a $20 computer repair kit that included an anti-static wristband that I wore while removing the desktops from their station mounts, cleaning them out with compressed air, and swapping in the mounted SSDs, new HDDs, expansion cards, and RAM modules.</p>
<p><img class="  wp-image-2460 aligncenter" src="{{ site.baseurl }}/images/img_2841.jpg" alt="IMG_2841.JPG" width="617" height="463" /></p>
<p>With the hardware upgrades completed, it was time to move on to software and RAID configuration. Using a free program called <a href="http://diskmakerx.com/" target="_blank">DiskMaker X6</a>, I had created a bootable El Capitan install disk on a USB stick (to save the time of having to download the installer to each of the four stations separately). Booting straight into this installer program (by plugging in the USB stick and holding down the Option key when turning on a Mac), I was able to quickly go through the process of installing OSX El Capitan on to the SSDs. For now that meant I could theoretically start up the desktop from either El Capitan (on the SSD) or Yosemite (still hosted on one of the HDDs) - but I wanted to wipe all the storage and start from scratch here.</p>
<p>I accomplished this using Disk Utility, the built-in program for drive management included with OSX. Once I had backed up all important user data from all the hard drives, I completely reformatted all of them (sticking with the default Mac OS Extended (Journaled) formatting), including the brand-new 1 TB drives. So now each station had an operating system SSD running El Capitan and three blank 1 TB hard drives to play with. As mentioned earlier, I wanted to put two of those in a <a href="https://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_0" target="_blank">RAID 0 data stripe</a> arrangement - a way of turning two separate drives into one logical "volume". RAID 0 is a mildly dangerous arrangement in that failure of either one of those drives means total data loss; but, it means a significant performance boost in read/write speed (hopefully decreasing the likelihood of dropped frames during capture, improving time spent on fixity checks and bagging, etc.), while maintaining a total of 2 TB storage on the drives (most RAID arrangements focused more on data security and redundancy, rather than performance, will result in a total amount of storage on the volume less than the capacity of the physical disks), and files are not meant to be stored long-term on these stations. They are either returned to the original institution, backed up to the more secure, RAID 6-arranged NAS, or backed up to our department's fleet of external drives - if not some combination of those options.</p>
<p>So it was at this point that I discovered that in the upgrade from Yosemite to El Capitan, Apple actually <em>removed</em> functionality from the Disk Utility application. The graphic interface for Disk Utility in Yosemite and earlier versions of OSX featured an option to easily customize RAID arrangements with your drives. In El Capitan (and, notably, El Capitan <em>only</em> - the feature has returned in Sierra), you're only allowed to erase, reformat and partition drives.</p>
<p><img class="  wp-image-2426 aligncenter" src="{{ site.baseurl }}/images/jboddiskutilityyosemite-577aac645f9b58587592afb8.jpg?w=680" alt="jboddiskutilityyosemite-577aac645f9b58587592afb8" width="565" height="376" /></p>
<p>[caption id="attachment_2428" align="aligncenter" width="566"]<img class="  wp-image-2428 aligncenter" src="{{ site.baseurl }}/images/screen-shot-2017-03-02-at-11-07-37-am.png?w=680" alt="screen-shot-2017-03-02-at-11-07-37-am" width="566" height="312" /> Cool. Cool cool cool.[/caption]</p>
<p>Which means to the Terminal we go. The command-line version of Disk Utility (invoked with the "diskutil" command) can still quickly create format a RAID volume. First, I have to run a quick</p>
<blockquote><p>$ diskutil list</p></blockquote>
<p>...in order to see the file paths/names for the two physical disks that I wanted to combine to create one volume (previously named MIAP_Class_Projects and Station_X_Backup):</p>
<p><img class="  wp-image-2433 aligncenter" src="{{ site.baseurl }}/images/screen-shot-2017-03-02-at-11-08-24-am.png" alt="screen-shot-2017-03-02-at-11-08-24-am" width="517" height="322" /></p>
<p>In this case, I was working with /dev/disk1 and /dev/disk3. Once I had the correct disks identified, I could use the following command:</p>
<blockquote><p>$ diskutil appleRAID create stripe JHFS+ disk1 disk3</p></blockquote>
<p>Let's break this down:</p>
<p><em>diskutil - </em>command used to invoke the Disk Utility application</p>
<p><em>appleRAID</em> - option to invoke the underlying function of Disk Utility that creates RAIDs - it's still there, they just removed it from the graphical version of Disk Utility in El Capitan for some reason ¯\_(ツ)_/¯</p>
<p><em>create stripe -</em> tells Disk Utility that I want to create a RAID 0 (striped) volume</p>
<p><em>JHFS+</em> - tells Disk Utility I want the striped volume to be formatted using the journaled HFS+ file system (the default Mac OS Extended (Journaled) formatting)</p>
<p><em>disk 1 disk 3</em> - lists the two drives, with the names taken from the previous command above, that I want to combine for this striped volume</p>
<p><span style="text-decoration:underline;">Note:</span> Be careful! When working with Disk Utility, especially in the command line, be sure you have all the data you want properly backed up. You can see how you could easily wipe/reformat disks by putting in the wrong disk number in the command.</p>
<p>End result: two physical disks combined to form a 2 TB volume, renamed to MIAP_Projects_RAID:</p>
<p>[caption id="attachment_2436" align="aligncenter" width="626"]<img class="  wp-image-2436 aligncenter" src="{{ site.baseurl }}/images/screen-shot-2017-03-02-at-11-15-37-am.png" alt="Screen Shot 2017-03-02 at 11.15.37 AM.png" width="626" height="392" /> The 2 TB RAID volume, visible in the GUI of Disk Utility - note the two physical drives are still listed in the "Internal" menu on the left, but without subset logical volumes, as with the SSD and El Capitan OS volume, or WDC hard drive with the "CS_Archive_Projects" volume.[/caption]</p>
<p>Hooray! That's about it. I did all of this with one station first, which allowed me the chance to reinstall all the software, both graphical and CLI, that we generally use in our courses, and test our usual video capture workflows. As mentioned before, my primary concern was older native-DV capture software like Final Cut 7 or Live Capture Plus would break, given that official OS support for those programs ended a long time ago, but near as I can tell they <em>can</em> still work in El Capitan. That's no guarantee, but I'll troubleshoot more when I get there (and keep around a bootable USB stick with OSX 10.9 Mavericks on it, just in case we have to go revert to using an older operating system to capture DV).</p>
<p>[caption id="attachment_2446" align="aligncenter" width="660"]<img class="aligncenter  wp-image-2446" src="{{ site.baseurl }}/images/screen-shot-2017-03-02-at-11-13-17-am.png" alt="Screen Shot 2017-03-02 at 11.13.17 AM.png" width="660" height="372" /> In order to not eat up memory on the 120 GB SSD operating system drive, I figured this was advisable.[/caption]</p>
<p>I wish that I had thought to actually run some timed tests <em>before</em> I made these upgrades, so that I would have some hard evidence of the improved processing power and time spent on transcoding, checksumming, etc. But I can say that having the operating system and applications hosted on solid-state memory, and the USB 3.0 transfer speeds to external drives, have certainly made a difference even to the unscientific eye. It's basically like we've had brand-new desktops installed - for a fraction of the cost. So if you're running a video digitization station, I highly recommend learning your way around the inside of a computer and the different components - whether you're on PC or still working with the old Mac Pro towers, just swapping in some fresh innards could make a big difference and save the trouble and expense of all-new machines. I can't speak to working with the new Mac Pros of course, but would be very interested to hear with anyone using those for digitization as to their flexibility - for instance, if I didn't already have the old Mac Pros to work with, and had been completely starting from scratch, what would you recommend? Buying the new Pros, or hunting down some of the older desktop stations, for the greater ability to customize them?</p>
